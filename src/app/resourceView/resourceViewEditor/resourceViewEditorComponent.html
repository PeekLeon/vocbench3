<div class="panel panel-default vbox blockingDivHost">
    <div class="panel-heading">
        <div class="hbox" style="align-items: center">
            <rdf-resource *ngIf="resource" [resource]="resource"></rdf-resource>
            <resource-rename [resource]="resource" style="flex: 1;" [readonly]="readonly" (update)="buildResourceView(resource)">
            </resource-rename>
            
            <button class="btn btn-default btn-xs" [ngClass]="{active: rendering}" style="margin-left: 3px;"
                title="Rendering" (click)="switchRendering()">
                <span class="glyphicon glyphicon-font"></span>
            </button>
            <button class="btn btn-default btn-xs" [ngClass]="{active: showInferred}" style="margin-left: 3px;"
                title="Show/hide inferred information" (click)="switchInferred()">
                <span *ngIf="showInferred" class="glyphicon glyphicon-eye-open"></span>
                <span *ngIf="!showInferred" class="glyphicon glyphicon-eye-close"></span>
            </button>
            <button class="btn btn-default btn-xs" [ngClass]="{active: valueFilterLangEnabled}" style="margin-left: 3px;"
                title="Enable/disable value-filter on languages" (click)="switchValueFilterLang()">
                <span class="glyphicon glyphicon-filter"></span>
            </button>
            
            <button *ngIf="notificationsAvailable" class="btn btn-default btn-xs" [ngClass]="{active: isWatching}" style="margin-left: 3px;"
                (click)="changeNotificationStatus()" title="Enable/Disable notifications on this resource">
                <span class="glyphicon glyphicon-bell"></span>
            </button>

            <div *ngIf="versioningAvailable" class="dropdown pull-right" style="margin-left: 3px;">
                <button class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" (click)="listVersions()" title="Change version">
                    <span class="glyphicon glyphicon-time"></span>
                </button>
                <ul class="dropdown-menu">
                    <li style="position: relative;">
                        <a (click)="switchToVersion()" style="padding-right: 18px">Current</a>
                        <span *ngIf="!activeVersion" class="glyphicon glyphicon-ok pull-right" style="position: absolute; right: 8px; top: 4px;"></span>
                    </li>
                    <li *ngFor="let v of versionList" style="position: relative;">
                        <a (click)="switchToVersion(v)" style="padding-right: 18px">{{v.dateTimeLocal}} - {{v.versionId}}</a>
                        <span *ngIf="v == activeVersion" class="glyphicon glyphicon-ok pull-right" style="position: absolute; right: 8px; top: 4px;"></span>
                    </li>
                </ul>
            </div>

            <div *ngIf="collaborationAvailable" class="dropdown pull-right" style="margin-left: 3px;">
                <button class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" title="Issues">
                    <span [class]="'glyphicon glyphicon-exclamation-sign ' + issuesStruct.btnClass"></span>
                </button>
                <ul class="dropdown-menu">
                    <li *ngFor="let i of issuesStruct.issues" >
                        <a [href]="i.getUrl()" target="_blank" [title]="i.getSummary()">
                            <span [class]="'label pull-right ' + i.getStatusClass()" style="font-size: 100%">{{i.getStatus()}}</span>
                            {{i.getKey()}}
                        </a>
                    </li>
                    <li *ngIf="issuesStruct.issues" role="separator" class="divider"></li>
                    <li><a (click)="createIssue()">Create issue for this resource</a></li>
                    <li><a (click)="assignToIssue()">Assign this resource to existing issue</a></li>
                </ul>
            </div>

            <button class="btn btn-default btn-xs" style="margin-left: 3px;" title="Refresh" (click)="buildResourceView(resource)">
                <span class="glyphicon glyphicon-refresh"></span>
            </button>

            <button *ngIf="settingsAvailable" class="btn btn-default btn-xs" style="margin-left: 3px;" title="ResourceView settings" (click)="openSettings()">
                <span class="glyphicon glyphicon-cog"></span>
            </button>
            
            <res-view-menu [resource]="resource" [rendering]="rendering" [showInferred]="showInferred" [readonly]="readonly" [projectCtx]="projectCtx"
                (update)="buildResourceView(resource)" (assertInferred)="assertInferredStatements()"></res-view-menu>
        </div>
    </div>
    <div class="panel-body scrollableContainer">
        <div *ngIf="unexistingResource" class="alert alert-danger">
            This resource is not available in the current project
        </div>
        <div *ngIf="unknownHost" class="alert alert-danger">
            This resource is not available on accessible local projects nor can be reached on the Web
        </div>
        <ng-template [ngIf]="!unexistingResource && !unknownHost">
            <types-renderer *ngIf="resViewSections['types']" [pred-obj-list]="resViewSections['types']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly"
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </types-renderer>
            <class-axiom-renderer *ngIf="resViewSections['classaxioms']" [pred-obj-list]="resViewSections['classaxioms']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </class-axiom-renderer>
            <top-concepts-renderer *ngIf="resViewSections['topconceptof']" [pred-obj-list]="resViewSections['topconceptof']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </top-concepts-renderer>
            <schemes-renderer *ngIf="resViewSections['schemes']" [pred-obj-list]="resViewSections['schemes']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </schemes-renderer>
            <broaders-renderer *ngIf="resViewSections['broaders']" [pred-obj-list]="resViewSections['broaders']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </broaders-renderer>
            <superproperties-renderer *ngIf="resViewSections['superproperties']" [pred-obj-list]="resViewSections['superproperties']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly"
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </superproperties-renderer>
            <equivalent-properties-renderer *ngIf="resViewSections['equivalentProperties']" [pred-obj-list]="resViewSections['equivalentProperties']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </equivalent-properties-renderer>
            <disjoint-properties-renderer *ngIf="resViewSections['disjointProperties']" [pred-obj-list]="resViewSections['disjointProperties']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </disjoint-properties-renderer>
            <property-chain-renderer *ngIf="resViewSections['subPropertyChains']" [pred-obj-list]="resViewSections['subPropertyChains']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </property-chain-renderer>
            <subterms-renderer *ngIf="resViewSections['subterms']" [pred-obj-list]="resViewSections['subterms']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </subterms-renderer>
            <domains-renderer *ngIf="resViewSections['domains']" [pred-obj-list]="resViewSections['domains']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly"
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </domains-renderer>
            <ranges-renderer *ngIf="resViewSections['ranges']" [pred-obj-list]="resViewSections['ranges']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly"
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </ranges-renderer>
            <property-facets-renderer *ngIf="resViewSections['facets'] && propertyFacets" [pred-obj-list]="resViewSections['facets']" [facets]="propertyFacets"
                [resource]="resource" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </property-facets-renderer>
            <datatype-definition-renderer *ngIf="resViewSections['datatypeDefinitions']" [pred-obj-list]="resViewSections['datatypeDefinitions']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </datatype-definition-renderer>
            <lexicalizations-renderer *ngIf="resViewSections['lexicalizations']" [pred-obj-list]="resViewSections['lexicalizations']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </lexicalizations-renderer>
            <lexical-forms-renderer *ngIf="resViewSections['lexicalForms']" [pred-obj-list]="resViewSections['lexicalForms']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </lexical-forms-renderer>
            <lexical-senses-renderer *ngIf="resViewSections['lexicalSenses']" [pred-obj-list]="resViewSections['lexicalSenses']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </lexical-senses-renderer>
            <denotations-renderer *ngIf="resViewSections['denotations']" [pred-obj-list]="resViewSections['denotations']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </denotations-renderer>
            <evoked-lexical-concepts-renderer *ngIf="resViewSections['evokedLexicalConcepts']" [pred-obj-list]="resViewSections['evokedLexicalConcepts']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </evoked-lexical-concepts-renderer>
            <notes-renderer *ngIf="resViewSections['notes']" [pred-obj-list]="resViewSections['notes']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly"
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </notes-renderer>
            <members-renderer *ngIf="resViewSections['members']" [pred-obj-list]="resViewSections['members']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly"
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </members-renderer>
            <members-ordered-renderer *ngIf="resViewSections['membersOrdered']" [pred-obj-list]="resViewSections['membersOrdered']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </members-ordered-renderer>
            <label-relations-renderer *ngIf="resViewSections['labelRelations']" [pred-obj-list]="resViewSections['labelRelations']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </label-relations-renderer>
            <form-representations-renderer *ngIf="resViewSections['formRepresentations']" [pred-obj-list]="resViewSections['formRepresentations']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </form-representations-renderer>
            <form-based-preview-renderer *ngIf="resViewSections['formBasedPreview']" [pred-obj-list]="resViewSections['formBasedPreview']" 
                [resource]="resource" [rendering]="rendering" [readonly]="true" 
                (dblclickObj)="objectDblClick($event)">
            </form-based-preview-renderer>
            <imports-renderer *ngIf="resViewSections['imports']" [pred-obj-list]="resViewSections['imports']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </imports-renderer>
            <constituents-renderer *ngIf="resViewSections['constituents']" [pred-obj-list]="resViewSections['constituents']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </constituents-renderer>
            <rdfs-members-renderer *ngIf="resViewSections['rdfsMembers']" [pred-obj-list]="resViewSections['rdfsMembers']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </rdfs-members-renderer>
            <properties-renderer *ngIf="resViewSections['properties']" [pred-obj-list]="resViewSections['properties']" 
                [resource]="resource" [rendering]="rendering" [readonly]="readonly" 
                (update)="buildResourceView(resource)" (dblclickObj)="objectDblClick($event)">
            </properties-renderer>
        </ng-template>
    </div>
    <div class="panel-footer" style="min-height: 31px;">
        <div *ngIf="resourcePosition" class="pull-right">
            <div class="dropup pull-right">
                <button class="btn btn-default dropdown-toggle btn-xs" data-toggle="dropdown" style="padding: 0px; border: none; background-color: transparent;">
                    <span [ngSwitch]="resource.getAdditionalProperty('accessMethod')">
                        Status:
                        <ng-template [ngSwitchCase]="'local'">
                            <span *ngIf="resourcePositionLocalProj" class="glyphicon glyphicon-saved"></span>
                            <span *ngIf="!resourcePositionLocalProj" class="glyphicon glyphicon-export"></span>
                        </ng-template>
                        <span *ngSwitchCase="'dereferenciation'" class="glyphicon glyphicon-save-file"></span>
                        <img *ngSwitchCase="'sparql'" src="../../../assets/images/icons/res/ontology.png" style="width: 11px; margin-bottom: 3px;">
                        <img *ngSwitchCase="'sparql-degraded'" src="../../../assets/images/icons/res/ontology.png" style="width: 11px; margin-bottom: 3px; opacity: .5;">
                    </span>
                    <span *ngIf="resourcePosition.isUnknown()" style="font-weight: 900; color: red;" title="Unknown position">!</span>
                </button>
                <ul class="dropdown-menu">
                    <li>
                        <a style="cursor: initial; background-color: initial;">
                            <label>Access method:</label>
                            {{resource.getAdditionalProperty('accessMethod')}}
                        </a>
                        <a *ngIf="resourcePosition.isLocal()" style="cursor: initial; background-color: initial;">
                            <label *ngIf="resourcePositionLocalProj">Local Project: </label>
                            <label *ngIf="!resourcePositionLocalProj">Other local Project: </label>
                            {{resourcePositionDetails}}
                        </a>
                        <a *ngIf="resourcePosition.isRemote()" style="cursor: initial; background-color: initial;">
                            <label>Remote Dataset: </label>
                            {{resourcePositionDetails}}
                        </a>
                        <a *ngIf="resourcePosition.isUnknown()" style="cursor: initial; background-color: initial;">
                            <label>Remote Dataset: </label>
                            Unknown, <a (click)="discoverDataset()">discover</a>
                        </a>
                    </li>
                </ul>
            </div>

        </div>
    </div>

    <div #blockDiv class="blockingDiv" style="display:none">
        <div class="loadingDiv">
            <div>
                <p>Loading...</p><img src="../../../assets/images/loading.gif" />
            </div>
        </div>
    </div>
    
</div>